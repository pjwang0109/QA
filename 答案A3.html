package com.ubot.lis.function.training;

import java.sql.SQLException;

import javax.servlet.http.HttpServletRequest;
import javax.ws.rs.Consumes;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

import org.json.JSONObject;

import com.ubot.lis.dbtraining.UserListDAO;
import com.ubot.lis.dbtraining.UserListVO;

/**
 * 修改
 */

@Path("/S010010003")
public class S010010003 {
    @Context
    HttpServletRequest req;

    private String rc = "M0000";

    @POST
    @Consumes(MediaType.APPLICATION_JSON + ";charset=UTF-8")
    @Produces(MediaType.APPLICATION_JSON + ";charset=UTF-8")
    public Response update(String jsonStr) throws SQLException {

        JSONObject json = new JSONObject();

        String msg = "";

        try {
            json = new JSONObject(jsonStr);
            String userId = json.getString("userid");
            String username = json.getString("username");
            String number = json.getString("number");
            String address = json.getString("address");
            String memo = json.getString("memo");

            // 更新資料庫
            boolean success = updateUser(userId, username, number, address, memo);

            if (success) {
                msg = "成功";
            } else {
                msg = "失敗";
                rc = "M9999";
            }
        } catch (Exception e) {
            e.printStackTrace();
            rc = "M9995";
            msg = "失敗";
        }

        JSONObject jsonOut = new JSONObject();
        jsonOut.put("msg", msg);
        return Response.status(200).entity(jsonOut.toString()).build();
    }

    private boolean updateUser(String userId, String username, String number, String address, String memo) {
        UserListDAO userListDAO = new UserListDAO();
        UserListVO userListVO = new UserListVO();

        userListVO.setUserid(userId);
        userListVO.setUsername(username);
        userListVO.setNumber(number);
        userListVO.setAddress(address);
        userListVO.setMemo(memo);

        // 調用 DAO 更新方法
        try {
            int success = userListDAO.update(userListVO);
            return success > 0;
        } catch (SQLException e) {
            e.printStackTrace();
            return false;
        }
    }
}