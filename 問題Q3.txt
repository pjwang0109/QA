<div class="container">
  <h3>產品資料表格</h3>
  <button id="add-year-btn" class="btn btn-primary">新增年度</button>
  <button id="add-product-btn" class="btn btn-success">新增產品</button>

  <table class="table table-bordered">
    <thead>
      <tr class="header-row">
        <th>產品名稱</th>
        <th>佔營收比</th>
        <!-- 年度欄位插入點 -->
      </tr>
    </thead>
    <tbody id="product-body">
      <!-- 產品資料列插入點 -->
    </tbody>
  </table>
</div>


<script>
  let maxYears = 3;
  let currentYear = 2023;
  let yearList = [];
  let productIndex = 0;

  $('#add-year-btn').on('click', function () {
    if (yearList.length >= maxYears) {
      alert("最多只能新增 " + maxYears + " 個年份！");
      return;
    }

    const year = currentYear++;
    yearList.push(year);

    // 在標題列加入新年度欄位
    $('.header-row').append(`
      <th class="year-${year}">
        ${year}
        <button class="btn btn-xs btn-danger" onclick="removeYear(${year})">
          <i class="glyphicon glyphicon-remove"></i>
        </button>
      </th>
    `);

    // 在每一筆產品資料列加入對應 input 欄位
    $('.product-row').each(function () {
      $(this).append(`
        <td class="year-${year}">
          <input type="text" class="form-control amount" placeholder="金額">
        </td>
      `);
    });
  });

  function removeYear(year) {
    // 移除標題與每一列的對應欄位
    $(`.year-${year}`).remove();
    yearList = yearList.filter(y => y !== year);
  }

  $('#add-product-btn').on('click', function () {
    productIndex++;
    const newRow = $('<tr class="product-row"></tr>');

    newRow.append(`
      <td>
        <textarea class="form-control pname" rows="1" placeholder="產品名稱"></textarea>
      </td>
      <td>
        <div class="input-group">
          <input type="text" class="form-control rate" maxlength="3" placeholder="%" />
          <span class="input-group-addon">%</span>
        </div>
      </td>
    `);

    // 為每個已新增的年度補欄位
    yearList.forEach(year => {
      newRow.append(`
        <td class="year-${year}">
          <input type="text" class="form-control amount" placeholder="金額">
        </td>
      `);
    });

    $('#product-body').append(newRow);
  });
</script>
