package com.ubot.lis.function.training;

import java.sql.SQLException;

import javax.servlet.http.HttpServletRequest;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.Context;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

import org.json.JSONArray;
import org.json.JSONObject;

import com.ubot.lis.dbtraining.UserListDAO;
import com.ubot.lis.dbtraining.UserListVO;

/**
 * 列表
 */

@Path("/S010010001")
public class S010010001 {
    @Context
    HttpServletRequest req;

    private String rc = "M0000";

    @GET
    @Produces(MediaType.APPLICATION_JSON + ";charset=UTF-8")
    public Response listAllUsers() throws SQLException {

        JSONArray userListArray = new JSONArray();

        try {
            userListArray = doJob();
        } catch (Exception e) {
            e.printStackTrace();
            rc = "M9995";
        }

        JSONObject jsonOut = new JSONObject();
        jsonOut.put("result", userListArray);

        return Response.status(200).entity(jsonOut.toString()).build();
    }

    private JSONArray doJob() throws SQLException {
        JSONArray out = new JSONArray();

        UserListDAO userListDAO = new UserListDAO();
        ArrayList<UserListVO> userList = userListDAO.getAllUsers();

        for (UserListVO user : userList) {
            JSONObject userJson = new JSONObject();
            userJson.put("userid", user.getUserid());
            userJson.put("username", user.getUsername());
            userJson.put("number", user.getNumber());
            userJson.put("address", user.getAddress());
            userJson.put("memo", user.getMemo());
            out.put(userJson);
        }

        return out;
    }
}
