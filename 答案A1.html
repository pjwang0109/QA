// 主要產品營收比重
let mpritemArr = dataObj["401mpritem"] || [];

const addMprItemBtn = $target.find(".product-add-btn:first");
const $productDiv = $target.find(".primaryProductDiv");
const $mprTable = $productDiv.find("table");

mpritemArr = mpritemArr.sort((a, b) => {
    const aN = Number(a["dataseq"]);
    const bN = Number(b["dataseq"]);
    return aN - bN;
});

// 先統整出所有年份，並儲存在該表格的 data 屬性中
if (mpritemArr.length > 0) {
    const yearSet = new Set();

    $.each(mpritemArr, function (_, item) {
        $.each(item.year_rate || {}, function (year, _) {
            yearSet.add(parseInt(year));
        });
    });

    const yearList = Array.from(yearSet).sort((a, b) => a - b);

    setYearList($productDiv, yearList);       // ⭐ 設定年份
    updateTableHeader($productDiv);           // ⭐ 畫出 <th>
}

for (const v of mpritemArr) {
    await addPrimaryProductTableDataCR(addMprItemBtn, v); // ⭐ 必須等年份列先畫好，才能正常畫每一列
}
