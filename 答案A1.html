document.addEventListener('DOMContentLoaded', ()=>{
    // div#root
    const root = document.querySelector('#root');

    // title
    const h2 = document.createElement('h2');
    h2.textContent = 'TEST TODO';

    // input
    const input = document.createElement('input');
    input.id = 'writeTodo' 
    input.type = 'text';
    
    // button 新增 todo
    const addBtn = document.createElement('button');
    addBtn.innerText = '新增待辦事項';
    addBtn.style.margin = '0 20px';

    root.appendChild(h2);
    root.appendChild(input);
    root.appendChild(addBtn);

    // 讓輸入框在頁面載入時自動獲得焦點
    input.focus();

    // todo 區塊
    const divBox = document.createElement('div');
    divBox.id = 'box';
    divBox.style.margin = '30px 0';
    root.appendChild(divBox);

    // 讀取 localStorage 並顯示
    loadTodos();

    // 監聽鍵盤事件，按 Enter 時新增代辦事項
    input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {  // 檢查是否按下 Enter
            addTodo();
        }
    });

    // 監聽按鈕點擊事件
    addBtn.addEventListener('click', addTodo);

    function addTodo() {
        const writeTodo = document.querySelector('#writeTodo'); // 取得 input 欄位
        const todoText = writeTodo.value.trim();

        // 檢查是否輸入內容
        if (todoText === '') return;

        // 新增至 localStorage
        saveTodo(todoText);

        // 清空輸入框並獲得焦點
        writeTodo.value = '';
        writeTodo.focus();

        // 重新渲染 todo 列表
        loadTodos();
    }

    function saveTodo(todoText) {
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        todos.push(todoText);
        localStorage.setItem('todos', JSON.stringify(todos));
    }

    function loadTodos() {
        // 清空畫面上的待辦事項
        divBox.innerHTML = '';

        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        
        todos.forEach((todoText, index) => {
            const todoBox = document.createElement('div');
            todoBox.classList.add('list');

            const span = document.createElement('span'); // 顯示待辦事項
            span.textContent = todoText;

            const todoDel = document.createElement('button'); // 刪除按鈕
            todoDel.classList.add('delete');
            todoDel.textContent = '刪除';

            // 刪除事件
            todoDel.addEventListener('click', () => {
                deleteTodo(index);
            });

            // 建立 todo 結構
            todoBox.appendChild(span);
            todoBox.appendChild(todoDel);
            divBox.appendChild(todoBox);
        });
    }

    function deleteTodo(index) {
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        todos.splice(index, 1);
        localStorage.setItem('todos', JSON.stringify(todos));

        // 重新渲染 todo 列表
        loadTodos();
    }
});
